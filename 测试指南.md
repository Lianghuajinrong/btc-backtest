# 测试指南

## 测试步骤

### 1. 确保后端运行
后端服务器已在后台启动，运行在 `http://127.0.0.1:8000`

如果后端未运行，请执行：
```bash
python backend.py
```

### 2. 打开前端页面
前端页面应该已经自动打开。如果没有，请手动打开 `index.html` 文件。

### 3. 测试新功能

#### 测试1：基础回测（无交易成本）
1. 设置参数：
   - 短均线：10
   - 长均线：50
   - 初始资金：10000
   - 手续费率：0
   - 滑点率：0
   - 止损：0（禁用）
   - 止盈：0（禁用）
2. 点击"运行回测"
3. 检查结果：
   - 应该显示回测结果
   - 查看新增指标：Sortino比率、Calmar比率、年化波动率、最大回撤天数

#### 测试2：启用交易成本
1. 设置参数：
   - 短均线：10
   - 长均线：50
   - 初始资金：10000
   - 手续费率：0.1%
   - 滑点率：0.05%
   - 止损：0（禁用）
   - 止盈：0（禁用）
2. 点击"运行回测"
3. 对比结果：
   - 总收益应该比测试1略低（因为扣除了交易成本）
   - 查看"手续费率"和"滑点率"是否显示正确

#### 测试3：启用止损止盈
1. 设置参数：
   - 短均线：10
   - 长均线：50
   - 初始资金：10000
   - 手续费率：0.1%
   - 滑点率：0.05%
   - 止损：5%（价格下跌5%时平仓）
   - 止盈：10%（价格上涨10%时平仓）
2. 点击"运行回测"
3. 检查结果：
   - 查看"止损"和"止盈"是否显示为"5.00%"和"10.00%"
   - 交易次数可能会增加（因为止损止盈会提前平仓）
   - 最大回撤应该被限制

#### 测试4：验证高级指标
检查以下指标是否正确显示：
- ✅ Sortino比率（应该是一个数字，可能为负数）
- ✅ Calmar比率（年化收益/最大回撤）
- ✅ 年化波动率（百分比）
- ✅ 最大回撤天数（天数）

### 4. API测试（可选）

如果后端API文档已打开（`http://127.0.0.1:8000/docs`），可以测试API：

**测试URL示例：**
```
http://127.0.0.1:8000/api/backtest/double_ma?short=10&long=50&initial_capital=10000&fee_rate=0.001&slippage_rate=0.0005&stop_loss_pct=5&take_profit_pct=10
```

**预期返回：**
- `summary` 中包含所有新指标
- `params` 中包含所有新参数

## 常见问题

### Q: 回测失败？
A: 检查后端是否运行，网络连接是否正常

### Q: 指标显示为 "--"？
A: 可能是数据不足或计算错误，检查浏览器控制台错误信息

### Q: 止损止盈没有生效？
A: 确保止损/止盈设置为大于0的值

## 预期结果

✅ 所有新功能都应该正常工作：
- 交易成本正确扣除
- 止损止盈正确触发
- 所有新指标正确显示
- 前端界面显示所有新参数
